<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>المدرسة السادسة والعشرون - تبوك</title>
  <meta name="description" content="نظام تقارير الأنشطة والحصص - المدرسة السادسة والعشرون بتبوك" />

  <style>
    :root{
      --green:#07A869; --teal:#0DA9A6; --dark:#0f172a; --muted:#475569; --border:#e2e8f0;
      --container:min(1100px,94vw);
    }
    *{box-sizing:border-box}
    html,body{margin:0;background:#fff;color:var(--dark);font-family:system-ui,"Segoe UI",Arial,sans-serif;line-height:1.65}

    /* رأس الموقع (الديباجة) - ثابت أثناء التصفح فقط */
    .letterhead{position:sticky;top:0;z-index:50;background:#fff;border-bottom:1px solid var(--border)}
    .letterhead .wrap{width:var(--container);margin-inline:auto;padding:8px 12px}
    .letterhead img{width:100%;max-height:110px;object-fit:contain;display:block}

    /* تنقل */
    nav{background:#f8fafc;border-bottom:1px solid var(--border)}
    .nav-wrap{width:var(--container);margin-inline:auto;display:flex;gap:10px;flex-wrap:wrap;justify-content:center;padding:10px 12px}
    .btn{appearance:none;border:1px solid var(--teal);background:#fff;color:#0b3d3a;padding:.6rem 1.1rem;border-radius:999px;font-weight:700;cursor:pointer;transition:.2s}
    .btn:hover{transform:translateY(-1px)}
    .btn.primary{background:linear-gradient(180deg,var(--teal),#079c93);border-color:transparent;color:#fff}
    .btn.danger{border-color:#b91c1c;color:#b91c1c}
    .btn.secondary{border-color:#64748b;color:#334155}

    /* الحاوية والصفحات */
    .container{width:var(--container);margin-inline:auto;padding:16px 12px}
    .page{display:none;background:#fff;padding:24px;border:1px solid var(--border);border-radius:12px;box-shadow:0 6px 24px rgba(2,6,23,.06);margin:16px 0}
    .page.active{display:block;animation:fadeIn .25s ease}
    @keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}

    h1{margin:.2rem 0 1rem;color:#0f766e;font-size:1.8rem}
    h2{margin:1rem 0 .6rem;color:#0f766e;font-size:1.2rem}

    /* نموذج الإدخال */
    .form{display:grid;gap:.9rem}
    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:.9rem}
    @media (max-width:900px){.grid2{grid-template-columns:1fr}}
    label{display:flex;flex-direction:column;gap:.3rem}
    .input{padding:.6rem .8rem;border:1px solid var(--border);border-radius:10px;background:#fff;color:#111827}
    textarea.input{min-height:110px;resize:vertical}

    .hint{font-size:.9rem;color:var(--muted)}
    .actions{display:flex;gap:.6rem;flex-wrap:wrap}

    /* شبكة الشواهد */
    .witness-grid{display:grid;gap:.6rem;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));margin-top:.6rem}
    .witness-grid img{aspect-ratio:4/3;object-fit:cover;border:1px solid var(--border);border-radius:8px}

    /* أقسام الطباعة الخضراء */
    .box-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:6px}
    .box{border:2px solid var(--green);border-radius:10px;padding:8px}
    .box .label{font-weight:700;color:#0f172a;margin-bottom:4px}
    .box .value{white-space:pre-wrap}

    /* جداول */
    table{width:100%;border-collapse:separate;border-spacing:0}
    th,td{border:2px solid var(--green);padding:6px 8px}
    thead th{background:#f0fff5}

    /* منطقة الطباعة العامة (تستخدم للأنشطة والحصص) */
    .print-root{display:none}
    .print-root .print-frame{width:100%;border-collapse:collapse}
    .print-root thead{display:table-header-group}
    .print-header img{width:100%;max-height:110px;object-fit:contain;display:block}
    .print-header h2{margin:.5rem 0 .6rem;color:#0f172a}

    /* تجنب الانقسام */
    .box, .witness-grid img, .print-table tr{break-inside:avoid;page-break-inside:avoid}

    /* تذليل الموقع فقط (لا يطبع) */
    .site-footer{margin:24px 0 40px;color:#334155}
    .site-footer .tags{display:flex;gap:.5rem;flex-wrap:wrap}
    .tag{border:1px dashed #94a3b8;color:#334155;border-radius:999px;padding:.2rem .7rem;font-size:.9rem}

    /* طباعة */
    @media print{
      body{background:#fff}
      .letterhead, nav, .site-footer, .page .form, .btn, .hint{display:none !important}
      .print-root{display:block !important}
      @page{size:A4; margin:12mm}
    }
  </style>
</head>
<body>
  <!-- ديباجة الموقع (ثابتة أثناء التصفح فقط) -->
  <header class="letterhead">
    <div class="wrap">
      <img src="26.png" alt="ديباجة المدرسة السادسة والعشرون بتبوك" onerror="this.insertAdjacentHTML('afterend','<div class=&quot;hint&quot; style=&quot;color:#b91c1c;margin:.5rem 0&quot;>⚠️ ضع صورة باسم <b>26.png</b> بجانب <b>index.html</b>.</div>'); this.remove();">
    </div>
  </header>

  <!-- التنقل -->
  <nav>
    <div class="nav-wrap">
      <button class="btn" onclick="showPage('home')">الصفحة الرئيسية</button>
      <button class="btn primary" onclick="showPage('activities')">تقارير الأنشطة</button>
      <button class="btn" onclick="showPage('sessions')">تقارير الحصص</button>
    </div>
  </nav>

  <main class="container">
    <!-- الرئيسية -->
    <section id="home" class="page active">
      <h1>نظام التقارير المدرسية</h1>
      <p class="hint">المدرسة السادسة والعشرون - تبوك. املأ النماذج ثم استخدم زر <b>طباعة / PDF</b>. التذليل ثابت بالموقع فقط، ولا يظهر داخل التقارير.</p>
    </section>

    <!-- الأنشطة -->
    <section id="activities" class="page">
      <h1>نموذج تقرير نشاط مدرسي</h1>

      <form id="activityForm" class="form">
        <div class="grid2">
          <label>اسم البرنامج<input class="input" name="title" required></label>
          <label>المنفذ<input class="input" name="owner" required></label>
          <label>المستهدفون<input class="input" name="beneficiaries" required></label>
          <label>عدد المستفيدين<input class="input" name="count" type="number" min="0" step="1" required></label>
          <label>تاريخ التنفيذ<input class="input" type="date" name="date" required></label>
          <label>مكان التنفيذ<input class="input" name="place" required></label>
        </div>
        <label>الأهداف<textarea class="input" name="goals" rows="3" placeholder="سرد نقطي"></textarea></label>
        <label>وصف مختصر<textarea class="input" name="desc" rows="3" placeholder="اختياري"></textarea></label>

        <fieldset style="border:1px solid var(--border);border-radius:10px;padding:10px">
          <legend style="padding:0 .4rem;color:#334155">الشواهد — حد أقصى 6 صور <span id="wCount">(0/6)</span></legend>
          <div class="actions">
            <input type="file" id="witnessFiles" accept="image/*" multiple hidden>
            <label for="witnessFiles" class="btn">إضافة صور</label>
            <button class="btn secondary" type="button" id="clearWitness">حذف الصور</button>
            <button class="btn primary" type="button" id="printActivity">طباعة / PDF</button>
          </div>
          <div id="witnessPreview" class="witness-grid"></div>
        </fieldset>
      </form>

      <!-- قالب الطباعة للأنشطة -->
      <section id="activityPrint" class="print-root" aria-hidden="true">
        <table class="print-frame">
          <thead>
            <tr><th>
              <div class="print-header">
                <img src="26.png" alt="ديباجة">
                <h2>تقرير نشاط مدرسي</h2>
              </div>
            </th></tr>
          </thead>
          <tbody>
            <tr><td>
              <div id="activityBoxes" class="box-grid"></div>
              <h3 style="margin-top:12px">الشواهد</h3>
              <div id="activityWitnessPrint" class="witness-grid"></div>
            </td></tr>
          </tbody>
        </table>
      </section>
    </section>

    <!-- الحصص -->
    <section id="sessions" class="page">
      <h1>تقرير حصص الانتظار</h1>
      <form class="form">
        <div class="grid2">
          <label>اليوم
            <select class="input" id="dayName" required>
              <option value="">اختر</option>
              <option>الأحد</option><option>الاثنين</option><option>الثلاثاء</option><option>الأربعاء</option><option>الخميس</option>
            </select>
          </label>
          <label>التاريخ<input class="input" type="date" id="sessionDate" required></label>
          <label>الصف<input class="input" id="className" required placeholder="مثال: الثالث الابتدائي"></label>
          <label>رقم الحصة<input class="input" type="number" id="sessionNumber" min="1" max="10" required></label>
          <label>المعلمة الغائبة<input class="input" id="absentTeacher" required></label>
        </div>
        <label>ما تم تنفيذه<textarea class="input" id="activitiesText" rows="3" required></textarea></label>

        <fieldset style="border:1px solid var(--border);border-radius:10px;padding:10px">
          <legend style="padding:0 .4rem;color:#334155">المجال</legend>
          <div class="actions" style="gap:.8rem">
            <label><input type="checkbox" id="basicSkills"> المهارات الأساسية</label>
            <label><input type="checkbox" id="values"> القيم والمواطنة الصالحة</label>
            <label><input type="checkbox" id="futureSkills"> مهارات المستقبل</label>
          </div>
        </fieldset>

        <div class="actions" style="margin-top:.6rem">
          <button class="btn" type="button" onclick="addSession()">حفظ الحصة</button>
          <button class="btn primary" type="button" id="printSessions">طباعة / PDF</button>
          <button class="btn danger" type="button" onclick="clearAllSessions()">مسح الكل</button>
        </div>
      </form>

      <h2 style="margin-top:1rem">الحصص المسجلة</h2>
      <div id="sessionsTableWrap" style="overflow:auto;border:1px solid var(--border);border-radius:10px">
        <table id="sessionsTable" class="print-table">
          <thead>
            <tr>
              <th style="width:48px">م</th>
              <th>اليوم</th>
              <th>التاريخ</th>
              <th>الصف</th>
              <th>الحصة</th>
              <th>المعلمة الغائبة</th>
              <th>ما تم تنفيذه</th>
              <th>المجال</th>
              <th class="no-print" style="width:80px">إجراء</th>
            </tr>
          </thead>
          <tbody id="sessionsBody"></tbody>
        </table>
      </div>

      <!-- قالب الطباعة للحصص -->
      <section id="sessionsPrint" class="print-root" aria-hidden="true">
        <table class="print-frame">
          <thead>
            <tr><th>
              <div class="print-header">
                <img src="26.png" alt="ديباجة">
                <h2>تقرير حصص الانتظار</h2>
              </div>
            </th></tr>
          </thead>
          <tbody>
            <tr><td>
              <table class="print-table" style="width:100%">
                <thead>
                  <tr>
                    <th>م</th><th>اليوم</th><th>التاريخ</th><th>الصف</th>
                    <th>الحصة</th><th>المعلمة الغائبة</th><th>ما تم تنفيذه</th><th>المجال</th>
                  </tr>
                </thead>
                <tbody id="sessionsPrintBody"></tbody>
              </table>
            </td></tr>
          </tbody>
        </table>
      </section>
    </section>

    <!-- تذليل الموقع (لا يظهر مطبوعًا) -->
    <footer class="site-footer">
      <div class="tags">
        <span class="tag">مديرة المدرسة: أماني آل عبشان</span>
        <span class="tag">تصميم الهيئة الإدارية: عيدة صلاح</span>
        <span class="tag">تصميم الهيئة الإدارية: منيرة العمراني</span>
      </div>
    </footer>
  </main>

  <script>
    // ===== Helpers =====
    const $ = (s,r=document)=>r.querySelector(s);
    const $$ = (s,r=document)=>[...r.querySelectorAll(s)];
    const storage = {
      get(k,f){try{return JSON.parse(localStorage.getItem(k))??f}catch{return f}},
      set(k,v){localStorage.setItem(k,JSON.stringify(v))}
    };
    function showPage(id){
      $$('.page').forEach(p=>p.classList.remove('active'));
      $('#'+id).classList.add('active');
      scrollTo({top:0,behavior:'smooth'});
    }
    function formatDate(v){
      try{return new Date(v).toLocaleDateString('ar-SA',{year:'numeric',month:'long',day:'numeric'})}catch{return v||''}
    }

    // ===== الأنشطة =====
    const formAct = $('#activityForm');
    const wInput = $('#witnessFiles');
    const wPrev  = $('#witnessPreview');
    const wCount = $('#wCount');
    let witness = [];

    function fileToDataURL(file){
      return new Promise((res,rej)=>{
        const fr = new FileReader();
        fr.onload=()=>res(fr.result); fr.onerror=rej; fr.readAsDataURL(file);
      });
    }

    wInput?.addEventListener('change', async (e)=>{
      witness=[]; wPrev.innerHTML="";
      const files=[...(e.target.files||[])].slice(0,6);
      for(const f of files){
        if(!f.type.startsWith('image/')) continue;
        const url = await fileToDataURL(f);
        witness.push({name:f.name,url});
        const img=new Image(); img.src=url; img.alt=f.name; img.loading="lazy";
        wPrev.appendChild(img);
      }
      wCount.textContent = `(${witness.length}/6)`;
    });
    $('#clearWitness')?.addEventListener('click',()=>{
      witness=[]; if(wInput) wInput.value=""; wPrev.innerHTML=""; wCount.textContent="(0/6)";
    });

    function buildActivityPrint(){
      const d = Object.fromEntries(new FormData(formAct).entries());
      const required = ['title','owner','beneficiaries','count','date','place'];
      for(const k of required){ if(!d[k]){ alert('أكمل الحقول الأساسية أولاً.'); return false; } }

      const fields = [
        ["اسم البرنامج", d.title],
        ["المنفذ", d.owner],
        ["المستهدفون", d.beneficiaries],
        ["عدد المستفيدين", d.count],
        ["تاريخ التنفيذ", formatDate(d.date)],
        ["مكان التنفيذ", d.place],
        ["الأهداف", d.goals||"—"],
        ["وصف مختصر", d.desc||"—"],
      ];
      $('#activityBoxes').innerHTML = fields.map(([k,v])=>`
        <div class="box">
          <div class="label">${k}</div>
          <div class="value">${String(v).replace(/\n/g,"<br>")}</div>
        </div>`).join("");

      const w = $('#activityWitnessPrint'); w.innerHTML="";
      witness.forEach(x=>{ const img=new Image(); img.src=x.url; img.alt=x.name; w.appendChild(img); });
      return true;
    }

    $('#printActivity')?.addEventListener('click', ()=>{
      if(!buildActivityPrint()) return;
      const root = $('#activityPrint');
      root.style.display='block';
      const prevTitle = document.title;
      document.title = `تقرير نشاط - المدرسة 26`;
      setTimeout(()=>window.print(), 30);
      window.onafterprint = ()=>{
        root.style.display='none';
        document.title = prevTitle;
        window.onafterprint=null;
      };
    });

    // ===== الحصص =====
    let sessions = storage.get('sessionsData',[]);
    function renderSessions(){
      const body = $('#sessionsBody');
      body.innerHTML = sessions.map((s,i)=>`
        <tr>
          <td>${i+1}</td>
          <td>${s.day}</td>
          <td>${formatDate(s.date)}</td>
          <td>${s.className}</td>
          <td>${s.number}</td>
          <td>${s.teacher}</td>
          <td style="text-align:right">${s.activities}</td>
          <td style="text-align:right">${s.fields}</td>
          <td class="no-print"><button class="btn danger" onclick="delSession(${i})">حذف</button></td>
        </tr>`).join("");
    }
    function addSession(){
      const day=$('#dayName').value.trim();
      const date=$('#sessionDate').value;
      const className=$('#className').value.trim();
      const number=$('#sessionNumber').value.trim();
      const teacher=$('#absentTeacher').value.trim();
      const acts=$('#activitiesText').value.trim();
      const fields=[];
      if($('#basicSkills').checked) fields.push('المهارات الأساسية');
      if($('#values').checked) fields.push('القيم والمواطنة الصالحة');
      if($('#futureSkills').checked) fields.push('مهارات المستقبل');

      if(!day||!date||!className||!number||!teacher||!acts||!fields.length){
        alert('أكمل كل الحقول واختر مجالاً واحدًا على الأقل.'); return;
      }
      sessions.push({day,date,className,number,teacher,activities:acts,fields:fields.join('، ')});
      storage.set('sessionsData',sessions);
      renderSessions();
      // تفريغ الحقول
      ['dayName','sessionDate','className','sessionNumber','absentTeacher','activitiesText'].forEach(id=>$('#'+id).value="");
      ['basicSkills','values','futureSkills'].forEach(id=>$('#'+id).checked=false);
    }
    function delSession(i){
      if(!confirm('حذف هذه الحصة؟')) return;
      sessions.splice(i,1);
      storage.set('sessionsData',sessions);
      renderSessions();
    }
    function clearAllSessions(){
      if(!sessions.length){alert('لا توجد حصص');return;}
      if(confirm('حذف جميع الحصص؟')){ sessions=[]; storage.set('sessionsData',sessions); renderSessions(); }
    }

    function buildSessionsPrint(){
      if(!sessions.length){ alert('لا توجد حصص للطباعة'); return false; }
      $('#sessionsPrintBody').innerHTML = sessions.map((s,i)=>`
        <tr>
          <td>${i+1}</td>
          <td>${s.day}</td>
          <td>${formatDate(s.date)}</td>
          <td>${s.className}</td>
          <td>${s.number}</td>
          <td>${s.teacher}</td>
          <td style="text-align:right">${s.activities}</td>
          <td style="text-align:right">${s.fields}</td>
        </tr>`).join("");
      return true;
    }
    $('#printSessions')?.addEventListener('click', ()=>{
      if(!buildSessionsPrint()) return;
      const root = $('#sessionsPrint');
      root.style.display='block';
      const prevTitle = document.title;
      document.title = `تقرير حصص الانتظار - المدرسة 26`;
      setTimeout(()=>window.print(), 30);
      window.onafterprint = ()=>{
        root.style.display='none';
        document.title = prevTitle;
        window.onafterprint=null;
      };
    });

    // بداية
    renderSessions();
  </script>
</body>
</html>
