<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>المدرسة السادسة والعشرون - تبوك</title>
  <meta name="description" content="نظام تقارير الأنشطة والحصص — المدرسة السادسة والعشرون بتبوك"/>

  <style>
    /* ====== هوية/ألوان (التصميم الأول) ====== */
    :root{
      --primary:#2E7D32; --primary-2:#388E3C; --accent:#FFB300;
      --ink:#0f172a; --muted:#475569; --border:#e2e8f0;
      --container:min(1200px,94vw);
      --print-margin:12mm; /* هوامش الطباعة */
    }
    *{box-sizing:border-box}
    html,body{margin:0;background:linear-gradient(135deg,var(--primary) 0%, var(--primary-2) 100%);color:var(--ink);font-family:"Segoe UI",system-ui,Arial,sans-serif;line-height:1.65}

    /* ديباجة ثابتة في الموقع فقط */
    .header-logo{background:#fff;padding:16px 20px;position:sticky;top:0;z-index:1000;border-bottom:1px solid var(--border);box-shadow:0 4px 12px rgba(0,0,0,.12)}
    .header-logo .wrap{width:var(--container);margin:auto}
    .header-logo img{width:100%;max-width:820px;max-height:110px;object-fit:contain;display:block;margin:auto}

    /* تنقل */
    nav{background:rgba(255,255,255,.98);box-shadow:0 2px 10px rgba(0,0,0,.10)}
    .nav{width:var(--container);margin:auto;display:flex;justify-content:center;gap:12px;flex-wrap:wrap;padding:14px}
    .btn{border:0;border-radius:30px;padding:12px 28px;font-weight:700;cursor:pointer;color:#fff;background:linear-gradient(135deg,var(--primary),var(--primary-2));box-shadow:0 4px 14px rgba(46,125,50,.35);transition:.2s}
    .btn:hover{transform:translateY(-2px)}
    .btn.alt{background:linear-gradient(135deg,#00796B,#00897B)}

    /* صفحات/حاوية */
    .container{width:var(--container);margin:auto;padding:24px}
    .card{background:#fff;border-radius:16px;padding:28px;box-shadow:0 12px 36px rgba(0,0,0,.25);margin:20px 0}
    .page{display:none}
    .page.active{display:block;animation:fade .3s}
    @keyframes fade{from{opacity:0;transform:translateY(18px)}to{opacity:1;transform:translateY(0)}}
    h1{color:var(--primary);text-align:center;margin:0 0 18px;font-size:34px}
    h2{color:var(--primary);border-right:6px solid var(--accent);padding-right:12px;margin:18px 0;font-size:22px}

    /* نماذج */
    .grid{display:grid;gap:12px}
    .grid-2{grid-template-columns:1fr 1fr}
    @media (max-width:900px){.grid-2{grid-template-columns:1fr}}
    label{display:flex;flex-direction:column;gap:6px}
    .input{padding:12px 14px;border:2px solid #ddd;border-radius:10px;background:#fafafa;font-size:16px}
    .input:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 4px rgba(46,125,50,.10)}
    textarea.input{min-height:110px;resize:vertical}

    .hint{color:var(--muted);font-size:.95rem}
    .actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:8px}

    /* عرض الشواهد (4 فقط) */
    .witness-grid{display:grid;gap:14px;grid-template-columns:repeat(4,1fr)}
    .witness-grid img{height:160px;object-fit:cover;border-radius:12px;box-shadow:0 4px 16px rgba(0,0,0,.18);border:3px solid #4CAF50}
    @media (max-width:900px){.witness-grid{grid-template-columns:repeat(2,1fr)}}

    /* جداول خضراء */
    table{width:100%;border-collapse:separate;border-spacing:0}
    th,td{border:2px solid #4CAF50;padding:10px 8px}
    thead th{background:#e8f5e9;color:#0b3d3a}

    /* منطقة الطباعة = صفحة A4 بدون تذليل الموقع */
    .print-root{display:none}
    .print-frame{width:100%;border-collapse:collapse}
    .print-frame thead{display:table-header-group} /* يكرر الديباجة أعلى كل صفحة */
    .print-header{padding-bottom:8px}
    .print-header img{width:100%;max-height:110px;object-fit:contain;display:block;margin:auto}
    .print-title{color:var(--primary);text-align:center;margin:6px 0 12px;font-size:22px}
    .box-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px}
    .box{border:2px solid #4CAF50;border-radius:10px;padding:10px}
    .box .label{font-weight:700;margin-bottom:4px;color:#0f172a}
    .value{white-space:pre-wrap;word-break:break-word}
    .print-witness{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:6px}
    .print-witness img{height:90mm;object-fit:cover;border-radius:8px;border:2px solid #4CAF50}
    /* منع انقسام العناصر */
    .box, .print-witness img, .print-table tr{break-inside:avoid;page-break-inside:avoid}

    /* تذليل الموقع (لا يُطبع) */
    .site-footer{color:#fff;text-align:center;margin:16px 0 28px}
    .badge{display:inline-block;margin:4px;border:1px dashed rgba(255,255,255,.6);padding:6px 10px;border-radius:999px;background:rgba(255,255,255,.06)}

    /* طباعة مضبوطة */
    @media print{
      body{background:#fff}
      .header-logo, nav, .site-footer, .card form, .btn{display:none !important}
      .print-root{display:block !important}
      @page{size:A4; margin: var(--print-margin)}
      /* ضبط عرض المحتوى ليلائم A4 */
      .print-page{width: calc(210mm - 2 * var(--print-margin));}
    }
  </style>
</head>
<body>
  <!-- ديباجة الموقع (ثابتة بالتصفح فقط) -->
  <header class="header-logo">
    <div class="wrap">
      <img src="26.png" alt="ديباجة المدرسة السادسة والعشرون بتبوك"
           onerror="this.insertAdjacentHTML('afterend','<div class=&quot;hint&quot; style=&quot;color:#b91c1c;margin:.5rem 0&quot;>⚠️ ارفع الصورة باسم <b>26.png</b> بجانب <b>index.html</b>.</div>'); this.remove();">
    </div>
  </header>

  <!-- تنقل -->
  <nav>
    <div class="nav">
      <button class="btn" onclick="go('home')">الصفحة الرئيسية</button>
      <button class="btn alt" onclick="go('activities')">تقارير الأنشطة</button>
      <button class="btn" onclick="go('sessions')">تقارير الحصص</button>
    </div>
  </nav>

  <main class="container">
    <!-- الصفحة الرئيسية -->
    <section id="home" class="card page active">
      <h1>نظام التقارير المدرسية</h1>
      <p class="hint">املأ البيانات ثم اضغط <b>طباعة / PDF</b>. الديباجة تطبع بالأعلى تلقائيًا. التذليل لا يظهر في التقرير.</p>
    </section>

    <!-- تقارير الأنشطة -->
    <section id="activities" class="card page">
      <h1>📊 تقرير النشاط المدرسي</h1>

      <form id="actForm" class="grid">
        <div class="grid grid-2">
          <label>اسم البرنامج<input class="input" name="title" required></label>
          <label>المنفذ<input class="input" name="owner" required></label>
          <label>المستهدفون<input class="input" name="beneficiaries" required></label>
          <label>عدد المستفيدين<input class="input" name="count" type="number" min="0" step="1" required></label>
          <label>تاريخ التنفيذ<input class="input" type="date" name="date" required></label>
          <label>مكان التنفيذ<input class="input" name="place" required></label>
        </div>
        <label>الأهداف<textarea class="input" name="goals" rows="3" placeholder="سرد نقطي"></textarea></label>
        <label>وصف مختصر<textarea class="input" name="desc" rows="3" placeholder="اختياري"></textarea></label>

        <div>
          <div class="actions">
            <input type="file" id="witnessFiles" accept="image/*" multiple hidden>
            <label for="witnessFiles" class="btn">إضافة صور الشواهد (حد أقصى 4)</label>
            <button class="btn alt" type="button" id="actPrintBtn">طباعة / PDF</button>
            <button class="btn" type="button" id="clearWitness">حذف الصور</button>
          </div>
          <div id="witnessPreview" class="witness-grid"></div>
          <div class="hint" id="wCount">(0/4)</div>
        </div>
      </form>

      <!-- صفحة الطباعة (A4) للأنشطة -->
      <section id="activityPrint" class="print-root" aria-hidden="true">
        <div class="print-page">
          <table class="print-frame">
            <thead>
              <tr><th>
                <div class="print-header">
                  <img src="26.png" alt="ديباجة">
                  <div class="print-title">تقرير نشاط مدرسي</div>
                </div>
              </th></tr>
            </thead>
            <tbody>
              <tr><td>
                <div id="activityBoxes" class="box-grid" style="margin-bottom:10px"></div>

                <h2 style="margin:8px 0 6px">الشواهد</h2>
                <div id="activityWitnessPrint" class="print-witness"></div>
              </td></tr>
            </tbody>
          </table>
        </div>
      </section>
    </section>

    <!-- تقارير الحصص -->
    <section id="sessions" class="card page">
      <h1>📝 تقرير حصص الانتظار</h1>

      <form class="grid">
        <div class="grid grid-2">
          <label>اليوم
            <select class="input" id="dayName" required>
              <option value="">اختر</option>
              <option>الأحد</option><option>الاثنين</option><option>الثلاثاء</option><option>الأربعاء</option><option>الخميس</option>
            </select>
          </label>
          <label>التاريخ<input class="input" type="date" id="sessionDate" required></label>
          <label>الصف<input class="input" id="className" required placeholder="مثال: الثالث الابتدائي"></label>
          <label>رقم الحصة<input class="input" type="number" id="sessionNumber" min="1" max="10" required></label>
          <label>المعلمة الغائبة<input class="input" id="absentTeacher" required></label>
        </div>
        <label>ما تم تنفيذه<textarea class="input" id="activitiesText" rows="3" required></textarea></label>

        <fieldset style="border:2px solid #4CAF50;border-radius:12px;padding:10px">
          <legend style="padding:0 .4rem;color:#0b3d3a">المجال</legend>
          <div class="actions">
            <label><input type="checkbox" id="basicSkills"> المهارات الأساسية</label>
            <label><input type="checkbox" id="values"> القيم والمواطنة الصالحة</label>
            <label><input type="checkbox" id="futureSkills"> مهارات المستقبل</label>
          </div>
        </fieldset>

        <div class="actions" style="margin-top:8px">
          <button class="btn" type="button" onclick="addSession()">حفظ الحصة</button>
          <button class="btn alt" type="button" id="sesPrintBtn">طباعة / PDF</button>
          <button class="btn" type="button" onclick="clearAllSessions()">مسح الكل</button>
        </div>
      </form>

      <h2>الحصص المسجلة</h2>
      <div style="overflow:auto;border:1px solid var(--border);border-radius:12px">
        <table id="sessionsTable">
          <thead>
            <tr>
              <th style="width:50px">م</th><th style="width:90px">اليوم</th><th style="width:120px">التاريخ</th><th>الصف</th>
              <th style="width:70px">الحصة</th><th style="width:160px">المعلمة الغائبة</th><th style="min-width:260px">ما تم تنفيذه</th><th style="min-width:170px">المجال</th>
              <th class="no-print" style="width:90px">إجراء</th>
            </tr>
          </thead>
          <tbody id="sessionsBody"></tbody>
        </table>
      </div>

      <!-- صفحة الطباعة (A4) للحصص -->
      <section id="sessionsPrint" class="print-root" aria-hidden="true">
        <div class="print-page">
          <table class="print-frame">
            <thead>
              <tr><th>
                <div class="print-header">
                  <img src="26.png" alt="ديباجة">
                  <div class="print-title">تقرير حصص الانتظار</div>
                </div>
              </th></tr>
            </thead>
            <tbody>
              <tr><td>
                <table class="print-table" style="width:100%">
                  <thead>
                    <tr>
                      <th>م</th><th>اليوم</th><th>التاريخ</th><th>الصف</th><th>الحصة</th><th>المعلمة الغائبة</th><th>ما تم تنفيذه</th><th>المجال</th>
                    </tr>
                  </thead>
                  <tbody id="sessionsPrintBody"></tbody>
                </table>
              </td></tr>
            </tbody>
          </table>
        </div>
      </section>
    </section>

    <!-- تذليل الموقع — لا يُطبع -->
    <footer class="site-footer">
      <span class="badge">مديرة المدرسة: أماني آل عبشان</span>
      <span class="badge">تصميم الهيئة الإدارية: عيدة صلاح</span>
      <span class="badge">تصميم الهيئة الإدارية: منيرة العمراني</span>
    </footer>
  </main>

  <script>
    /* ======= أدوات عامة ======= */
    const $ = (s,r=document)=>r.querySelector(s);
    const $$ = (s,r=document)=>[...r.querySelectorAll(s)];
    const store = {get:k=>JSON.parse(localStorage.getItem(k)||"[]"), set:(k,v)=>localStorage.setItem(k,JSON.stringify(v))};

    function go(id){ $$('.page').forEach(p=>p.classList.remove('active')); $('#'+id).classList.add('active'); scrollTo({top:0,behavior:'smooth'}); }
    const fmt = v => { try{return new Date(v).toLocaleDateString('ar-SA',{year:'numeric',month:'long',day:'numeric'})}catch{return v||''} };

    /* ======= الأنشطة: شواهد = 4 فقط، طباعة A4 ======= */
    const actForm = $('#actForm');
    const wInput  = $('#witnessFiles');
    const wPrev   = $('#witnessPreview');
    const wCount  = $('#wCount');
    let witness = [];

    function fileToDataURL(file){ return new Promise((res,rej)=>{ const fr=new FileReader(); fr.onload=()=>res(fr.result); fr.onerror=rej; fr.readAsDataURL(file); }); }

    wInput?.addEventListener('change', async (e)=>{
      witness=[]; wPrev.innerHTML="";
      const files=[...(e.target.files||[])].filter(f=>f.type.startsWith('image/')).slice(0,4);
      for(const f of files){
        const url=await fileToDataURL(f);
        witness.push({name:f.name,url});
        const img=new Image(); img.src=url; img.alt=f.name; img.loading='lazy';
        wPrev.appendChild(img);
      }
      wCount.textContent=`(${witness.length}/4)`;
    });

    $('#clearWitness')?.addEventListener('click', ()=>{
      witness=[]; if(wInput) wInput.value=""; wPrev.innerHTML=""; wCount.textContent="(0/4)";
    });

    function buildActivityPrint(){
      const d = Object.fromEntries(new FormData(actForm).entries());
      const req = ['title','owner','beneficiaries','count','date','place'];
      for(const k of req){ if(!d[k]){ alert('أكمل الحقول الأساسية أولاً.'); return false; } }

      const fields = [
        ['اسم البرنامج', d.title],
        ['المنفذ', d.owner],
        ['المستهدفون', d.beneficiaries],
        ['عدد المستفيدين', d.count],
        ['تاريخ التنفيذ', fmt(d.date)],
        ['مكان التنفيذ', d.place],
        ['الأهداف', d.goals||'—'],
        ['وصف مختصر', d.desc||'—'],
      ];
      $('#activityBoxes').innerHTML = fields.map(([k,v])=>`
        <div class="box"><div class="label">${k}</div><div class="value">${String(v).replace(/\n/g,'<br>')}</div></div>`).join('');

      const w = $('#activityWitnessPrint'); w.innerHTML="";
      witness.forEach(x=>{ const img=new Image(); img.src=x.url; img.alt=x.name; w.appendChild(img); });
      return true;
    }

    $('#actPrintBtn')?.addEventListener('click', ()=>{
      if(!buildActivityPrint()) return;
      const root = $('#activityPrint');
      root.style.display='block';
      const prev = document.title; document.title='تقرير نشاط - المدرسة 26';
      setTimeout(()=>window.print(), 20);
      window.onafterprint = ()=>{ root.style.display='none'; document.title=prev; window.onafterprint=null; };
    });

    /* ======= الحصص: حفظ محلي + طباعة A4 ======= */
    let sessions = store.get('sessionsData');
    function renderSessions(){
      const body = $('#sessionsBody');
      body.innerHTML = sessions.map((s,i)=>`
        <tr>
          <td>${i+1}</td><td>${s.day}</td><td>${fmt(s.date)}</td><td>${s.className}</td>
          <td>${s.number}</td><td>${s.teacher}</td>
          <td style="text-align:right">${s.activities}</td><td style="text-align:right">${s.fields}</td>
          <td class="no-print"><button class="btn" style="background:linear-gradient(135deg,#D32F2F,#C62828)" onclick="delSession(${i})">حذف</button></td>
        </tr>`).join('');
    }
    function addSession(){
      const day=$('#dayName').value.trim();
      const date=$('#sessionDate').value;
      const cls=$('#className').value.trim();
      const num=$('#sessionNumber').value.trim();
      const t=$('#absentTeacher').value.trim();
      const acts=$('#activitiesText').value.trim();
      const fields=[];
      if($('#basicSkills').checked) fields.push('المهارات الأساسية');
      if($('#values').checked) fields.push('القيم والمواطنة الصالحة');
      if($('#futureSkills').checked) fields.push('مهارات المستقبل');
      if(!day||!date||!cls||!num||!t||!acts||!fields.length){ alert('أكمل كل الحقول واختر مجالاً واحدًا على الأقل.'); return; }

      sessions.push({day,date,className:cls,number:num,teacher:t,activities:acts,fields:fields.join('، ')});
      store.set('sessionsData',sessions); renderSessions();
      ['dayName','sessionDate','className','sessionNumber','absentTeacher','activitiesText'].forEach(id=>$('#'+id).value="");
      ['basicSkills','values','futureSkills'].forEach(id=>$('#'+id).checked=false);
    }
    function delSession(i){ if(!confirm('حذف هذه الحصة؟')) return; sessions.splice(i,1); store.set('sessionsData',sessions); renderSessions(); }
    function clearAllSessions(){ if(!sessions.length){alert('لا توجد حصص');return;} if(confirm('حذف جميع الحصص؟')){ sessions=[]; store.set('sessionsData',sessions); renderSessions(); } }

    function buildSessionsPrint(){
      if(!sessions.length){ alert('لا توجد حصص للطباعة'); return false; }
      $('#sessionsPrintBody').innerHTML = sessions.map((s,i)=>`
        <tr>
          <td>${i+1}</td><td>${s.day}</td><td>${fmt(s.date)}</td><td>${s.className}</td>
          <td>${s.number}</td><td>${s.teacher}</td>
          <td style="text-align:right">${s.activities}</td><td style="text-align:right">${s.fields}</td>
        </tr>`).join('');
      return true;
    }

    $('#sesPrintBtn')?.addEventListener('click', ()=>{
      if(!buildSessionsPrint()) return;
      const root = $('#sessionsPrint');
      root.style.display='block';
      const prev = document.title; document.title='تقرير حصص الانتظار - المدرسة 26';
      setTimeout(()=>window.print(), 20);
      window.onafterprint = ()=>{ root.style.display='none'; document.title=prev; window.onafterprint=null; };
    });

    // تشغيل أولي
    renderSessions();
  </script>
</body>
</html>
